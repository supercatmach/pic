<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta http-equiv="Content-Security-Policy" content="connect-src 'self' https://mj-production-43c2.up.railway.app wss://mj-production-43c2.up.railway.app https://catchat-a7zb.onrender.com https://mj-5x4w.onrender.com wss://mj-5x4w.onrender.com;">
<meta property="og:image" content="backg/endshures.jpg">
<meta property="og:image:type" content="image/png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:title" content="超科學麻將社">
<title>超科學麻將社</title>
<script type="text/javascript" src="jquery2.min.js"></script>
<script type="text/javascript" src="zutop.js"></script>
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js"></script>
<body>
<script>

allmgd=[]
cantoutcd=[]
etmgd=[[10,11,12],[10,11,12]]///,[25,26,27]
daetp=[0,0,0,0]

lbmgds=[0,0,0,0]
ple=3
roomId="025024"
mtd=2




plmgd=[2,2,2,3,3,3,5,5,5,8,8,11,12,13,14,15,16]
mytsale=0
wincad=11

dimwincad=0
dubnum=0
ineyes=0

cpf = Array(35).fill(0);

if(mytsale!=1){///非自摸 扣掉胡牌

  const idx = plmgd.indexOf(wincad);
  if (idx !== -1) plmgd.splice(idx, 1);
  plmgd.sort((a, b) => a - b);

sortCad()

if(crdeye==0){

plmgd.push(wincad);
plmgd.sort((a, b) => a - b);

ineyes=1

}

}

// 統計手牌張數
for (let i = 0; i < plmgd.length; i++) {
  cpf[plmgd[i]]++;
}
let i = 1;
let used = Array(35).fill(false); // 防止重複試同一個牌

while (i < 35) {
  if (cpf[i] >= 3 && !used[i]) {
    sortCad();
    let baseTSP = manum + ((crdeye > 0) ? 1 : 0);

    // 移除三張牌 i
    let removed = [];
    for (let j = plmgd.length - 1; j >= 0 && removed.length < 3; j--) {
      if (plmgd[j] === i) {
        removed.push(plmgd[j]);
        plmgd.splice(j, 1);
      }
    }

    sortCad();
    const newTSP = manum + ((crdeye > 0) ? 1 : 0);

    if (newTSP === baseTSP - 1 && crdeye > 0) {
      dubnum++;
      // 已經成功處理，不用還原
      used = Array(35).fill(false); // 重置 used（可能影響別的牌）
      i = 1; // 重新開始
    } else {
      // 沒成功，還原
      plmgd = plmgd.concat(removed);
      plmgd.sort((a, b) => a - b);
      used[i] = true; // 加入黑名單，下次不再試
      i++; // 試下一張
    }

    // 重建 cpf
    cpf = Array(35).fill(0);
    for (let k = 0; k < plmgd.length; k++) {
      cpf[plmgd[k]]++;
    }
  } else {
    i++;
  }
}


if(mytsale!=1&&ineyes==0){///非自摸 扣掉胡牌

plmgd.push(wincad);
plmgd.sort((a, b) => a - b);

}

sortCad()


console.log(dubnum,manum,crdeye,plmgd)




function sortCad(){///整理方式

manum=0///組數

crdeye=0///眼

dacadnum=[]///萬筒條各個組數

cpf=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]

canet=[]
canet[0]=[]
canet[1]=[3]
canet[2]=[1,4]
canet[3]=[2,5]
canet[4]=[3,6]
canet[5]=[4,7]
canet[6]=[5,8]
canet[7]=[6,9]
canet[8]=[7]
canet[9]=[]
canet[10]=[12]
canet[11]=[10,13]
canet[12]=[11,14]
canet[13]=[12,15]
canet[14]=[13,16]
canet[15]=[14,17]
canet[16]=[15,18]
canet[17]=[16]
canet[18]=[]
canet[19]=[21]
canet[20]=[19,22]
canet[21]=[20,23]
canet[22]=[21,24]
canet[23]=[22,25]
canet[24]=[23,26]
canet[25]=[24,27]
canet[26]=[25]
canet[27]=[]



plmgd.forEach(function(x) { cpf[x] = (cpf[x] || 0)+1; })///計算出現過的總張數

cpf.splice(0,1)

cpf.length=34


for(let i=27;i<34;i++){

if(cpf[i]>0){///超過1

cpf[i]=(cpf[i]<5)?cpf[i]:4

if(zutop[cpf[i]]!=undefined){

manum+=zutop[cpf[i]][0]///組數

crdeye+=zutop[cpf[i]][1]///眼

}

}

}

for(let k=0;k<3;k++){

lanhow=[]///連號

for(let i=k*9;i<k*9+9;i++){

if(cpf[i]>0&&i==k*9+8){///超過1

cpf[i]=(cpf[i]<5)?cpf[i]:4

lanhow.push(cpf[i])

lanhow=lanhow.join("")

if(zutop[lanhow]!=undefined){

manum+=zutop[lanhow][0]///組數

crdeye+=zutop[lanhow][1]///眼

}

if(zutop[lanhow]==undefined){

manum+=0///組數

crdeye+=0///眼

}

lanhow=[]

break

}


if(cpf[i]>0){///超過1

cpf[i]=(cpf[i]<5)?cpf[i]:4

lanhow.push(cpf[i])

for(let s=i+1;s<k*9+9;s++){

if(cpf[s]>0){///超過1

cpf[s]=(cpf[s]<5)?cpf[s]:4

lanhow.push(cpf[s])

}


if(cpf[s]==0||s==k*9+8){///沒超過1

lanhow=lanhow.join("")


if(zutop[lanhow]!=undefined){

manum+=zutop[lanhow][0]///組數

crdeye+=zutop[lanhow][1]///眼

}

if(zutop[lanhow]==undefined){

manum+=0///組數

crdeye+=0///眼

alert(lanhow)

}

lanhow=[]

i=s///(s!=8)?s-1:s

break

}

}

}

}

dacadnum.push(manum+crdeye)

}

dacadnum[1]=dacadnum[1]-dacadnum[0]
dacadnum[2]=dacadnum[2]-dacadnum[1]-dacadnum[0]
dacadnum[3]=0

for(let i=27;i<34;i++){

if(cpf[i]>=2){///

dacadnum[3]++

}

}

}

///////////////////////////////////////




</script>